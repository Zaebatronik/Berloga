# üêª KupyProdai - –ü–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è –∫–æ–¥–∞ (24.11.2025)

## –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### ‚ö° Real-time —á–∞—Ç —á–µ—Ä–µ–∑ Socket.IO
- –°–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç **–º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ** –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ MongoDB –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏

### üì± –ú–æ–±–∏–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- –£–≤–µ–ª–∏—á–µ–Ω—ã –∫–Ω–æ–ø–∫–∏ –¥–ª—è touch-—É—Å—Ç—Ä–æ–π—Å—Ç–≤
- –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∑–æ–Ω–∞ –¥–ª—è iPhone (notch)
- –ü–ª–∞–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –¥–ª—è iOS
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã –∏ —Ä–∞–∑–º–µ—Ä—ã

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
frontend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ App.tsx                 # –ì–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å —Ä–æ—É—Ç–∏–Ω–≥–æ–º
‚îÇ   ‚îú‚îÄ‚îÄ main.tsx               # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SimpleChatPage.tsx  # Real-time —á–∞—Ç (Socket.IO)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AddListingPage.tsx  # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CatalogPage.tsx     # –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MainMenu.tsx        # –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ... (–æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã)
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api.ts             # API –∫–ª–∏–µ–Ω—Ç (axios + endpoints)
‚îÇ   ‚îú‚îÄ‚îÄ store/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts           # Zustand store
‚îÇ   ‚îî‚îÄ‚îÄ i18n/
‚îÇ       ‚îî‚îÄ‚îÄ locales/           # 7 —è–∑—ã–∫–æ–≤ (RU, EN, UK, DE, FR, ES, PL)

backend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ server.js              # Express + Socket.IO —Å–µ—Ä–≤–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Chat.js            # –ú–æ–¥–µ–ª—å —á–∞—Ç–∞ (MongoDB)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Listing.js         # –ú–æ–¥–µ–ª—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ User.js            # –ú–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ   ‚îî‚îÄ‚îÄ routes/
‚îÇ       ‚îú‚îÄ‚îÄ chats.js           # API –¥–ª—è —á–∞—Ç–æ–≤
‚îÇ       ‚îú‚îÄ‚îÄ listings.js        # API –¥–ª—è –æ–±—ä—è–≤–ª–µ–Ω–∏–π
‚îÇ       ‚îî‚îÄ‚îÄ users.js           # API –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```

---

## üîë –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã

### 1. SimpleChatPage.tsx - Real-time —á–∞—Ç

```typescript
import { useState, useEffect, useRef } from 'react';
import { useParams, useNavigate } from 'react-router-dom';
import { useStore } from '../store';
import { io, Socket } from 'socket.io-client';
import { chatsAPI } from '../services/api';

interface Message {
  _id?: string;
  senderId: string;
  text: string;
  createdAt?: string;
}

const API_URL = import.meta.env.VITE_API_URL || 'https://kupiyproday.onrender.com';
let socket: Socket | null = null;

export default function SimpleChatPage() {
  const { listingId } = useParams<{ listingId: string }>();
  const navigate = useNavigate();
  const { user, listings } = useStore();
  const messagesEndRef = useRef<HTMLDivElement>(null);
  
  const [messages, setMessages] = useState<Message[]>([]);
  const [messageText, setMessageText] = useState('');
  const [listing, setListing] = useState<any>(null);
  const [chatId, setChatId] = useState<string>('');
  const [loading, setLoading] = useState(true);

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Socket.IO –∏ –∑–∞–≥—Ä—É–∑–∫–∞ —á–∞—Ç–∞
  useEffect(() => {
    if (!listingId || !user) return;

    const foundListing = listings.find(l => l.id === listingId);
    if (!foundListing) {
      alert('–û–±—ä—è–≤–ª–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
      navigate('/catalog');
      return;
    }

    setListing(foundListing);

    // –ü–æ–¥–∫–ª—é—á–∞–µ–º Socket.IO
    if (!socket) {
      socket = io(API_URL);
    }

    // –°–æ–∑–¥–∞—ë–º –∏–ª–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º —á–∞—Ç —Å —Å–µ—Ä–≤–µ—Ä–∞
    const initChat = async () => {
      try {
        const isSeller = foundListing.userId === user.id || foundListing.userId === user.telegramId;
        const sellerId = foundListing.userId;
        const buyerId = isSeller ? 'temp_buyer' : user.id;

        // –°–æ–∑–¥–∞—ë–º —á–∞—Ç (–µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - –≤–µ—Ä–Ω—ë—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)
        const response = await chatsAPI.create({
          listingId,
          participants: [
            { userId: sellerId, nickname: foundListing.userNickname },
            { userId: buyerId, nickname: isSeller ? '–ü–æ–∫—É–ø–∞—Ç–µ–ª—å' : user.nickname }
          ]
        });

        const chat = response.data;
        setChatId(chat._id);
        setMessages(chat.messages || []);

        // –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ–º—Å—è –∫ –∫–æ–º–Ω–∞—Ç–µ —á–∞—Ç–∞
        socket?.emit('join-chat', chat._id);

        // –°–ª—É—à–∞–µ–º –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        socket?.on('new-message', (message: Message) => {
          setMessages(prev => [...prev, message]);
        });

        setLoading(false);
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —á–∞—Ç–∞:', error);
        setLoading(false);
      }
    };

    initChat();

    return () => {
      socket?.off('new-message');
    };
  }, [listingId, user, listings, navigate]);

  // –ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞
  useEffect(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  }, [messages]);

  // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
  const handleSend = async () => {
    if (!messageText.trim() || !user || !chatId) return;

    const newMessage: Message = {
      senderId: user.id,
      text: messageText.trim()
    };

    try {
      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä (MongoDB)
      await chatsAPI.sendMessage(chatId, newMessage);

      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —á–µ—Ä–µ–∑ Socket.IO –¥–ª—è –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏
      socket?.emit('send-message', {
        chatId,
        message: newMessage
      });

      setMessageText('');

      if (window.Telegram?.WebApp?.HapticFeedback) {
        window.Telegram.WebApp.HapticFeedback.impactOccurred('light');
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', error);
      alert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ');
    }
  };

  const handleKeyPress = (e: React.KeyboardEvent) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      handleSend();
    }
  };

  const handleDeleteMessage = async (messageId: string) => {
    if (!confirm('–£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ?')) return;
    setMessages(prev => prev.filter(m => m._id !== messageId));
  };

  if (loading || !listing) {
    return <div style={{ padding: '20px', textAlign: 'center' }}>–ó–∞–≥—Ä—É–∑–∫–∞ —á–∞—Ç–∞...</div>;
  }

  const otherUserNickname = listing.userId === user?.id 
    ? '–ü–æ–∫—É–ø–∞—Ç–µ–ª—å' 
    : listing.userNickname;

  return (
    <div style={{
      display: 'flex',
      flexDirection: 'column',
      height: '100vh',
      background: 'var(--tg-theme-bg-color, #fff)'
    }}>
      {/* –®–∞–ø–∫–∞ */}
      <div style={{
        padding: '16px',
        borderBottom: '1px solid var(--tg-theme-hint-color, #e5e7eb)',
        display: 'flex',
        alignItems: 'center',
        gap: '12px',
        background: 'var(--tg-theme-secondary-bg-color, #f9fafb)'
      }}>
        <button
          onClick={() => navigate(-1)}
          style={{
            width: '36px',
            height: '36px',
            borderRadius: '50%',
            border: 'none',
            background: 'var(--tg-theme-button-color, #3b82f6)',
            color: 'var(--tg-theme-button-text-color, white)',
            fontSize: '18px',
            cursor: 'pointer'
          }}
        >
          ‚Üê
        </button>
        <div>
          <div style={{ fontWeight: 600, fontSize: '16px' }}>{otherUserNickname}</div>
          <div style={{ fontSize: '12px', color: 'var(--tg-theme-hint-color, #9ca3af)' }}>
            {listing.title}
          </div>
        </div>
      </div>

      {/* –°–æ–æ–±—â–µ–Ω–∏—è */}
      <div style={{
        flex: 1,
        overflowY: 'auto',
        padding: '16px',
        display: 'flex',
        flexDirection: 'column',
        gap: '16px',
        WebkitOverflowScrolling: 'touch'
      }}>
        {messages.length === 0 ? (
          <div style={{
            textAlign: 'center',
            padding: '40px 20px',
            color: 'var(--tg-theme-hint-color, #9ca3af)',
            fontSize: '14px'
          }}>
            üëã –ù–∞—á–Ω–∏—Ç–µ –¥–∏–∞–ª–æ–≥!<br />
            –ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –æ —Ç–æ–≤–∞—Ä–µ
          </div>
        ) : (
          messages.map((msg) => {
            const isMyMessage = msg.senderId === user?.id;
            return (
              <div
                key={msg._id || \`msg-\${Math.random()}\`}
                style={{
                  display: 'flex',
                  justifyContent: isMyMessage ? 'flex-end' : 'flex-start'
                }}
              >
                <div style={{
                  maxWidth: '80%',
                  padding: '12px 16px',
                  borderRadius: '16px',
                  background: isMyMessage 
                    ? 'var(--tg-theme-button-color, #3b82f6)' 
                    : 'var(--tg-theme-secondary-bg-color, #f3f4f6)',
                  color: isMyMessage 
                    ? 'var(--tg-theme-button-text-color, white)' 
                    : 'var(--tg-theme-text-color, #000)',
                  position: 'relative'
                }}>
                  {isMyMessage && (
                    <button
                      onClick={() => handleDeleteMessage(msg._id!)}
                      style={{
                        position: 'absolute',
                        top: '-10px',
                        right: '-10px',
                        width: '28px',
                        height: '28px',
                        borderRadius: '50%',
                        border: 'none',
                        background: '#ef4444',
                        color: 'white',
                        fontSize: '16px',
                        fontWeight: 'bold',
                        cursor: 'pointer',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        boxShadow: '0 2px 4px rgba(0,0,0,0.2)',
                        padding: '0'
                      }}
                    >
                      √ó
                    </button>
                  )}
                  <div style={{ fontSize: '14px', wordWrap: 'break-word' }}>
                    {msg.text}
                  </div>
                  <div style={{
                    fontSize: '11px',
                    marginTop: '4px',
                    opacity: 0.7
                  }}>
                    {msg.createdAt ? new Date(msg.createdAt).toLocaleTimeString('ru-RU', {
                      hour: '2-digit',
                      minute: '2-digit'
                    }) : ''}
                  </div>
                </div>
              </div>
            );
          })
        )}
        <div ref={messagesEndRef} />
      </div>

      {/* –ü–æ–¥—Å–∫–∞–∑–∫–∞ –æ–± –æ–±–º–µ–Ω–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏ */}
      <div style={{
        padding: '8px 16px',
        background: '#fef3c7',
        borderTop: '1px solid #fbbf24',
        fontSize: '12px',
        textAlign: 'center',
        color: '#92400e'
      }}>
        üí° –î–æ–≥–æ–≤–æ—Ä–∏–ª–∏—Å—å? –û–±–º–µ–Ω—è–π—Ç–µ—Å—å –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ
      </div>

      {/* –ü–æ–ª–µ –≤–≤–æ–¥–∞ */}
      <div style={{
        padding: '12px 16px',
        paddingBottom: 'max(12px, env(safe-area-inset-bottom))',
        borderTop: '1px solid var(--tg-theme-hint-color, #e5e7eb)',
        display: 'flex',
        gap: '8px',
        background: 'var(--tg-theme-bg-color, #fff)'
      }}>
        <input
          type="text"
          value={messageText}
          onChange={(e) => setMessageText(e.target.value)}
          onKeyPress={handleKeyPress}
          placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."
          style={{
            flex: 1,
            padding: '12px 16px',
            borderRadius: '22px',
            border: '1px solid var(--tg-theme-hint-color, #e5e7eb)',
            background: 'var(--tg-theme-secondary-bg-color, #f9fafb)',
            color: 'var(--tg-theme-text-color, #000)',
            fontSize: '16px',
            outline: 'none',
            minHeight: '44px'
          }}
        />
        <button
          onClick={handleSend}
          disabled={!messageText.trim()}
          style={{
            width: '44px',
            height: '44px',
            borderRadius: '50%',
            border: 'none',
            background: messageText.trim() 
              ? 'var(--tg-theme-button-color, #3b82f6)' 
              : '#d1d5db',
            color: 'white',
            fontSize: '18px',
            cursor: messageText.trim() ? 'pointer' : 'not-allowed'
          }}
        >
          ‚û§
        </button>
      </div>

      {/* –ö–Ω–æ–ø–∫–∞ –æ–±–º–µ–Ω–∞ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏ */}
      <div style={{ 
        padding: '12px 16px', 
        paddingTop: 0,
        paddingBottom: 'max(12px, env(safe-area-inset-bottom))'
      }}>
        <button
          onClick={() => {
            const telegramUrl = \`https://t.me/user?id=\${listing.userId}\`;
            if (window.Telegram?.WebApp) {
              window.Telegram.WebApp.openTelegramLink(telegramUrl);
            }
          }}
          style={{
            width: '100%',
            padding: '12px',
            borderRadius: '12px',
            border: 'none',
            background: '#10b981',
            color: 'white',
            fontSize: '14px',
            fontWeight: 600,
            cursor: 'pointer'
          }}
        >
          üìû –û—Ç–∫—Ä—ã—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç –ø—Ä–æ–¥–∞–≤—Ü–∞
        </button>
      </div>
    </div>
  );
}
```

---

### 2. App.tsx - –ì–ª–∞–≤–Ω—ã–π —Ä–æ—É—Ç–∏–Ω–≥

```typescript
import { useEffect, useState } from 'react';
import { BrowserRouter, Routes, Route, Navigate } from 'react-router-dom';
import { useTranslation } from 'react-i18next';
import { useStore } from './store';

// Pages
import WelcomePage from './pages/WelcomePage';
import AgreementPage from './pages/AgreementPage';
import LocationPage from './pages/LocationPage';
import RadiusPage from './pages/RadiusPage';
import NicknamePage from './pages/NicknamePage';
import MainMenu from './pages/MainMenu';
import CatalogPage from './pages/CatalogPage';
import ListingDetailPage from './pages/ListingDetailPage';
import AddListingPage from './pages/AddListingPage';
import MyListingsPage from './pages/MyListingsPage';
import ProfilePage from './pages/ProfilePage';
import FavoritesPage from './pages/FavoritesPage';
import SupportPage from './pages/SupportPage';
import SimpleChatPage from './pages/SimpleChatPage';
import AdminPage from './pages/AdminPage';
import UserProfilePage from './pages/UserProfilePage';
import GoodbyePage from './pages/GoodbyePage';
import BannedPage from './pages/BannedPage';

function App() {
  const { i18n } = useTranslation();
  const { isRegistered, language, user } = useStore();
  const [isBanned, setIsBanned] = useState(false);
  const [i18nReady, setI18nReady] = useState(false);

  useEffect(() => {
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
    if (window.Telegram?.WebApp) {
      const tg = window.Telegram.WebApp;
      tg.ready();
      tg.expand();
    }

    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —è–∑—ã–∫–∞
    const initLanguage = async () => {
      await i18n.changeLanguage(language);
      setI18nReady(true);
    };
    initLanguage();

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π
    const processPendingRegistration = async () => {
      const pending = localStorage.getItem('pendingRegistration');
      if (pending) {
        try {
          const { userData, timestamp } = JSON.parse(pending);
          const hoursSince = (Date.now() - timestamp) / (1000 * 60 * 60);
          
          if (hoursSince > 24) {
            localStorage.removeItem('pendingRegistration');
            return;
          }
          
          const { userAPI } = await import('./services/api');
          const response = await userAPI.register(userData);
          localStorage.removeItem('pendingRegistration');
        } catch (error) {
          console.log('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–ª–æ–∂–µ–Ω–Ω—É—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é');
        }
      }
    };

    processPendingRegistration();
  }, [language, i18n]);

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–Ω–∞
  useEffect(() => {
    const checkBanStatus = async () => {
      if (isRegistered && user?.id) {
        try {
          const { userAPI } = await import('./services/api');
          const response = await userAPI.getProfile(user.id);
          if (response.data.banned) {
            setIsBanned(true);
          }
        } catch (error) {
          console.error('Failed to check ban status:', error);
        }
      }
    };

    checkBanStatus();
    const interval = setInterval(checkBanStatus, 5000);
    return () => clearInterval(interval);
  }, [isRegistered, user]);

  if (!i18nReady) {
    return (
      <div style={{
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        height: '100vh',
        background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
        color: 'white',
        fontSize: '18px',
        fontWeight: '600'
      }}>
        üêª –ó–∞–≥—Ä—É–∑–∫–∞...
      </div>
    );
  }

  if (isBanned) {
    return (
      <BrowserRouter>
        <Routes>
          <Route path="*" element={<BannedPage />} />
        </Routes>
      </BrowserRouter>
    );
  }

  return (
    <BrowserRouter>
      <Routes>
        <Route path="/goodbye" element={<GoodbyePage />} />
        
        {!isRegistered ? (
          <>
            <Route path="/" element={<WelcomePage />} />
            <Route path="/agreement" element={<AgreementPage />} />
            <Route path="/location" element={<LocationPage />} />
            <Route path="/radius" element={<RadiusPage />} />
            <Route path="/nickname" element={<NicknamePage />} />
            <Route path="*" element={<Navigate to="/" replace />} />
          </>
        ) : (
          <>
            <Route path="/" element={<MainMenu />} />
            <Route path="/menu" element={<MainMenu />} />
            <Route path="/catalog" element={<CatalogPage />} />
            <Route path="/listing/:id" element={<ListingDetailPage />} />
            <Route path="/add" element={<AddListingPage />} />
            <Route path="/add-listing" element={<AddListingPage />} />
            <Route path="/my-listings" element={<MyListingsPage />} />
            <Route path="/profile" element={<ProfilePage />} />
            <Route path="/favorites" element={<FavoritesPage />} />
            <Route path="/support" element={<SupportPage />} />
            <Route path="/chat/:listingId" element={<SimpleChatPage />} />
            <Route path="/admin" element={<AdminPage />} />
            <Route path="/user/:userId" element={<UserProfilePage />} />
          </>
        )}
      </Routes>
    </BrowserRouter>
  );
}

export default App;
```

---

### 3. Backend server.js - Socket.IO —Å–µ—Ä–≤–µ—Ä

```javascript
const express = require('express');
const cors = require('cors');
const mongoose = require('mongoose');
const { createServer } = require('http');
const { Server } = require('socket.io');
const path = require('path');
require('dotenv').config();

const app = express();
const httpServer = createServer(app);
const io = new Server(httpServer, {
  cors: {
    origin: '*',
    methods: ['GET', 'POST'],
  },
});

// Middleware
app.use(cors());
app.use(express.json({ limit: '50mb' }));
app.use(express.urlencoded({ limit: '50mb', extended: true }));
app.use('/uploads', express.static('uploads'));

app.set('io', io);

// Routes
const usersRouter = require('./routes/users');
const listingsRouter = require('./routes/listings');
const chatsRouter = require('./routes/chats');
const reportsRouter = require('./routes/reports');
const notificationsRouter = require('./routes/notifications');

app.use('/api/users', usersRouter);
app.use('/api/listings', listingsRouter);
app.use('/api/chats', chatsRouter);
app.use('/api/reports', reportsRouter);
app.use('/api/notifications', notificationsRouter);

app.use('/users', usersRouter);
app.use('/listings', listingsRouter);
app.use('/chats', chatsRouter);
app.use('/reports', reportsRouter);
app.use('/notifications', notificationsRouter);

// Health check
app.get('/health', (req, res) => {
  res.json({ status: 'ok', timestamp: new Date().toISOString() });
});

// Socket.IO –¥–ª—è real-time —á–∞—Ç–æ–≤
io.on('connection', (socket) => {
  console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥–∫–ª—é—á–∏–ª—Å—è:', socket.id);

  socket.on('join-chat', (chatId) => {
    socket.join(chatId);
    console.log(\`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è –∫ —á–∞—Ç—É: \${chatId}\`);
  });

  socket.on('send-message', (data) => {
    io.to(data.chatId).emit('new-message', data.message);
  });

  socket.on('disconnect', () => {
    console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–ª—é—á–∏–ª—Å—è:', socket.id);
  });
});

// MongoDB –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
const PORT = process.env.PORT || 5000;
const MONGODB_URI = process.env.MONGODB_URI || 'mongodb://localhost:27017/kupyprodai';

mongoose
  .connect(MONGODB_URI, {
    serverSelectionTimeoutMS: 5000,
    socketTimeoutMS: 45000,
  })
  .then(() => {
    console.log('‚úÖ MongoDB —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω');
    httpServer.listen(PORT, () => {
      console.log(\`üöÄ –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É \${PORT}\`);
    });
  })
  .catch((err) => {
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ MongoDB:', err);
    process.exit(1);
  });
```

---

## üåê API Endpoints

### –ß–∞—Ç—ã
- `GET /chats/user/:userId` - –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —á–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `GET /chats/:id` - –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —á–∞—Ç
- `POST /chats` - –°–æ–∑–¥–∞—Ç—å —á–∞—Ç
- `POST /chats/:id/messages` - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
- `POST /chats/:id/share-contacts` - –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏

### –û–±—ä—è–≤–ª–µ–Ω–∏—è
- `GET /listings` - –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
- `GET /listings/:id` - –ü–æ–ª—É—á–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –ø–æ ID
- `POST /listings` - –°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
- `PUT /listings/:id` - –û–±–Ω–æ–≤–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
- `DELETE /listings/:id` - –£–¥–∞–ª–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `GET /users` - –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `POST /users/register` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `GET /users/:id` - –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
- `PUT /users/:id` - –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
- `DELETE /users/:id` - –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Environment –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (.env)

```env
PORT=5000
MONGODB_URI=mongodb+srv://username:password@cluster.mongodb.net/kupyprodai
NODE_ENV=production
TELEGRAM_BOT_TOKEN=7939786678:AAHSujmve3UREb9YLpZZWY2fiA00qUj0Fz8
```

### Frontend (frontend/.env)

```env
VITE_API_URL=https://kupiyproday.onrender.com
```

---

## üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### Frontend (package.json)

```json
{
  "dependencies": {
    "react": "^18.3.1",
    "react-dom": "^18.3.1",
    "react-router-dom": "^6.28.0",
    "react-i18next": "^15.1.3",
    "i18next": "^23.17.4",
    "zustand": "^5.0.2",
    "axios": "^1.7.9",
    "socket.io-client": "^4.8.1"
  }
}
```

### Backend (package.json)

```json
{
  "dependencies": {
    "express": "^4.21.2",
    "mongoose": "^8.9.3",
    "cors": "^2.8.5",
    "dotenv": "^16.4.7",
    "socket.io": "^4.8.1",
    "node-telegram-bot-api": "^0.66.0"
  }
}
```

---

## üöÄ –î–µ–ø–ª–æ–π

### Frontend - Cloudflare Pages
- URL: https://kupyprodai.pages.dev
- Auto-deploy –∏–∑ GitHub (main branch)
- Build: `npm run build`
- Output: `dist/`

### Backend - Render.com
- URL: https://kupiyproday.onrender.com
- Auto-deploy –∏–∑ GitHub
- Free tier (—Å–ø–∏—Ç –ø–æ—Å–ª–µ 15 –º–∏–Ω –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏)
- MongoDB Atlas –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

---

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. ‚úÖ **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** (7 —è–∑—ã–∫–æ–≤)
2. ‚úÖ **–ü—É–±–ª–∏–∫–∞—Ü–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏–π** —Å —Ñ–æ—Ç–æ
3. ‚úÖ **–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤** —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
4. ‚úÖ **Real-time —á–∞—Ç** —á–µ—Ä–µ–∑ Socket.IO
5. ‚úÖ **–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è** (—Å—Ç—Ä–∞–Ω–∞ + –≥–æ—Ä–æ–¥ + —Ä–∞–¥–∏—É—Å)
6. ‚úÖ **–ò–∑–±—Ä–∞–Ω–Ω–æ–µ** (localStorage)
7. ‚úÖ **–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å** (ID: 670170626)
8. ‚úÖ **–°–∏—Å—Ç–µ–º–∞ –±–∞–Ω–æ–≤**
9. ‚úÖ **Telegram Web App** –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
10. ‚úÖ **–ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è**

---

## üìù TODO (–≤ –ø–ª–∞–Ω–∞—Ö)

- [ ] –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–ø–∏—Å–∫–∞ —á–∞—Ç–æ–≤
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö
- [ ] –ü–µ—Ä–µ–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —á–∞—Ç–µ
- [ ] –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ –≤ —á–∞—Ç
- [ ] –†–µ–π—Ç–∏–Ω–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [ ] –°–∏—Å—Ç–µ–º–∞ –æ—Ç–∑—ã–≤–æ–≤
- [ ] –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Å–¥–µ–ª–∫–∞ (—ç—Å–∫—Ä–æ—É)
- [ ] Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- [ ] Telegram –±–æ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ 24/7

---

## üêª –ö–æ–Ω—Ç–∞–∫—Ç—ã

- **–ü—Ä–æ–µ–∫—Ç**: KupyProdai (–ö—É–ø–ª—é/–ü—Ä–æ–¥–∞–π)
- **GitHub**: https://github.com/Zaebatronik/KupiyProday
- **–°–∞–π—Ç**: https://kupyprodai.pages.dev
- **API**: https://kupiyproday.onrender.com
- **Telegram Bot**: @KupyProdaiBot

---

*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 24 –Ω–æ—è–±—Ä—è 2025*
*Real-time —á–∞—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç! üéâ*
